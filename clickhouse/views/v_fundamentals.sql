CREATE VIEW v_fundamentals AS
WITH generated_years AS (
    SELECT
        inn,
        arrayJoin(range(min_year, toYear(current_date()) + 1)) AS year
    FROM (
        SELECT inn, MIN(year) AS min_year FROM fundamentals GROUP BY inn
    )
), enriched_data AS (
    SELECT
        g.inn,
        g.year,
        argMax(f."1100", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1100",
        argMax(f."1110", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1110",
        argMax(f."1120", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1120",
        argMax(f."1130", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1130",
        argMax(f."1140", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1140",
        argMax(f."1150", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1150",
        argMax(f."1160", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1160",
        argMax(f."1170", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1170",
        argMax(f."1180", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1180",
        argMax(f."1190", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1190",
        argMax(f."1200", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1200",
        argMax(f."1210", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1210",
        argMax(f."1220", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1220",
        argMax(f."1230", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1230",
        argMax(f."1240", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1240",
        argMax(f."1250", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1250",
        argMax(f."1260", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1260",
        argMax(f."1300", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1300",
        argMax(f."1310", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1310",
        argMax(f."1320", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1320",
        argMax(f."1340", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1340",
        argMax(f."1350", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1350",
        argMax(f."1360", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1360",
        argMax(f."1370", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1370",
        argMax(f."1400", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1400",
        argMax(f."1410", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1410",
        argMax(f."1420", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1420",
        argMax(f."1430", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1430",
        argMax(f."1450", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1450",
        argMax(f."1500", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1500",
        argMax(f."1510", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1510",
        argMax(f."1520", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1520",
        argMax(f."1530", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1530",
        argMax(f."1540", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1540",
        argMax(f."1550", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1550",
        argMax(f."1600", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1600",
        argMax(f."1700", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "1700",
        argMax(f."2100", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2100",
        argMax(f."2110", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2110",
        argMax(f."2120", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2120",
        argMax(f."2200", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2200",
        argMax(f."2210", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2210",
        argMax(f."2220", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2220",
        argMax(f."2300", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2300",
        argMax(f."2310", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2310",
        argMax(f."2320", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2320",
        argMax(f."2330", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2330",
        argMax(f."2340", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2340",
        argMax(f."2350", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2350",
        argMax(f."2400", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2400",
        argMax(f."2410", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2410",
        argMax(f."2421", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2421",
        argMax(f."2430", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2430",
        argMax(f."2450", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2450",
        argMax(f."2460", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2460",
        argMax(f."2500", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2500",
        argMax(f."2510", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2510",
        argMax(f."2520", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2520",
        argMax(f."3200", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3200",
        argMax(f."3300", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3300",
        argMax(f."3310", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3310",
        argMax(f."3311", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3311",
        argMax(f."3312", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3312",
        argMax(f."3313", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3313",
        argMax(f."3314", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3314",
        argMax(f."3315", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3315",
        argMax(f."3316", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3316",
        argMax(f."3320", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3320",
        argMax(f."3321", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3321",
        argMax(f."3322", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3322",
        argMax(f."3323", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3323",
        argMax(f."3324", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3324",
        argMax(f."3325", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3325",
        argMax(f."3326", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3326",
        argMax(f."3327", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3327",
        argMax(f."3330", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3330",
        argMax(f."3340", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3340",
        argMax(f."3600", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3600",
        argMax(f."4100", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4100",
        argMax(f."4110", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4110",
        argMax(f."4111", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4111",
        argMax(f."4112", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4112",
        argMax(f."4113", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4113",
        argMax(f."4119", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4119",
        argMax(f."4120", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4120",
        argMax(f."4121", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4121",
        argMax(f."4122", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4122",
        argMax(f."4123", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4123",
        argMax(f."4124", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4124",
        argMax(f."4129", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4129",
        argMax(f."4200", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4200",
        argMax(f."4210", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4210",
        argMax(f."4211", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4211",
        argMax(f."4212", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4212",
        argMax(f."4213", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4213",
        argMax(f."4214", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4214",
        argMax(f."4219", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4219",
        argMax(f."4220", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4220",
        argMax(f."4221", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4221",
        argMax(f."4222", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4222",
        argMax(f."4223", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4223",
        argMax(f."4224", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4224",
        argMax(f."4229", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4229",
        argMax(f."4300", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4300",
        argMax(f."4310", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4310",
        argMax(f."4311", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4311",
        argMax(f."4312", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4312",
        argMax(f."4313", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4313",
        argMax(f."4314", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4314",
        argMax(f."4319", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4319",
        argMax(f."4320", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4320",
        argMax(f."4321", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4321",
        argMax(f."4322", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4322",
        argMax(f."4323", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4323",
        argMax(f."4329", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4329",
        argMax(f."4400", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4400",
        argMax(f."4490", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4490",
        argMax(f."6100", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6100",
        argMax(f."6200", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6200",
        argMax(f."6210", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6210",
        argMax(f."6215", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6215",
        argMax(f."6220", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6220",
        argMax(f."6230", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6230",
        argMax(f."6240", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6240",
        argMax(f."6250", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6250",
        argMax(f."6300", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6300",
        argMax(f."6310", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6310",
        argMax(f."6311", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6311",
        argMax(f."6312", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6312",
        argMax(f."6313", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6313",
        argMax(f."6320", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6320",
        argMax(f."6321", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6321",
        argMax(f."6322", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6322",
        argMax(f."6323", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6323",
        argMax(f."6324", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6324",
        argMax(f."6325", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6325",
        argMax(f."6326", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6326",
        argMax(f."6330", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6330",
        argMax(f."6350", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6350",
        argMax(f."6400", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "6400",
        argMax(f."2411", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2411",
        argMax(f."4450", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4450",
        argMax(f."4500", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "4500",
        argMax(f."2412", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2412",
        argMax(f."3100", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3100",
        argMax(f."3210", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3210",
        argMax(f."3211", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3211",
        argMax(f."3230", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3230",
        argMax(f."3400", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3400",
        argMax(f."3401", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3401",
        argMax(f."3402", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3402",
        argMax(f."3500", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3500",
        argMax(f."3501", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3501",
        argMax(f."3502", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3502",
        argMax(f."3220", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3220",
        argMax(f."3221", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3221",
        argMax(f."3410", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3410",
        argMax(f."3411", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3411",
        argMax(f."2900", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2900",
        argMax(f."2910", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2910",
        argMax(f."3213", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3213",
        argMax(f."3227", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3227",
        argMax(f."3223", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3223",
        argMax(f."3420", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3420",
        argMax(f."3421", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3421",
        argMax(f."3240", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3240",
        argMax(f."3212", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3212",
        argMax(f."3222", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3222",
        argMax(f."2530", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "2530",
        argMax(f."3216", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3216",
        argMax(f."3226", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3226",
        argMax(f."3214", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3214",
        argMax(f."3215", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3215",
        argMax(f."3224", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3224",
        argMax(f."3225", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3225",
        argMax(f."3412", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3412",
        argMax(f."3422", f.year) OVER (PARTITION BY g.inn ORDER BY g.year) AS "3422"
    FROM generated_years AS g
    LEFT JOIN fundamentals AS f
    ON g.inn = f.inn AND g.year = f.year
)
SELECT
    inn,
    year,
    "1100",
    "1110",
    "1120",
    "1130",
    "1140",
    "1150",
    "1160",
    "1170",
    "1180",
    "1190",
    "1200",
    "1210",
    "1220",
    "1230",
    "1240",
    "1250",
    "1260",
    "1300",
    "1310",
    "1320",
    "1340",
    "1350",
    "1360",
    "1370",
    "1400",
    "1410",
    "1420",
    "1430",
    "1450",
    "1500",
    "1510",
    "1520",
    "1530",
    "1540",
    "1550",
    "1600",
    "1700",
    "2100",
    "2110",
    "2120",
    "2200",
    "2210",
    "2220",
    "2300",
    "2310",
    "2320",
    "2330",
    "2340",
    "2350",
    "2400",
    "2410",
    "2421",
    "2430",
    "2450",
    "2460",
    "2500",
    "2510",
    "2520",
    "3200",
    "3300",
    "3310",
    "3311",
    "3312",
    "3313",
    "3314",
    "3315",
    "3316",
    "3320",
    "3321",
    "3322",
    "3323",
    "3324",
    "3325",
    "3326",
    "3327",
    "3330",
    "3340",
    "3600",
    "4100",
    "4110",
    "4111",
    "4112",
    "4113",
    "4119",
    "4120",
    "4121",
    "4122",
    "4123",
    "4124",
    "4129",
    "4200",
    "4210",
    "4211",
    "4212",
    "4213",
    "4214",
    "4219",
    "4220",
    "4221",
    "4222",
    "4223",
    "4224",
    "4229",
    "4300",
    "4310",
    "4311",
    "4312",
    "4313",
    "4314",
    "4319",
    "4320",
    "4321",
    "4322",
    "4323",
    "4329",
    "4400",
    "4490",
    "6100",
    "6200",
    "6210",
    "6215",
    "6220",
    "6230",
    "6240",
    "6250",
    "6300",
    "6310",
    "6311",
    "6312",
    "6313",
    "6320",
    "6321",
    "6322",
    "6323",
    "6324",
    "6325",
    "6326",
    "6330",
    "6350",
    "6400",
    "2411",
    "4450",
    "4500",
    "2412",
    "3100",
    "3210",
    "3211",
    "3230",
    "3400",
    "3401",
    "3402",
    "3500",
    "3501",
    "3502",
    "3220",
    "3221",
    "3410",
    "3411",
    "2900",
    "2910",
    "3213",
    "3227",
    "3223",
    "3420",
    "3421",
    "3240",
    "3212",
    "3222",
    "2530",
    "3216",
    "3226",
    "3214",
    "3215",
    "3224",
    "3225",
    "3412",
    "3422"
FROM enriched_data
ORDER BY inn, year
SETTINGS join_use_nulls = 1
